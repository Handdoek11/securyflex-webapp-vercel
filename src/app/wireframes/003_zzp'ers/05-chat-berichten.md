# ZZP Chat - Berichten & Communicatie

## Overzicht
Het Chat systeem verbindt ZZP'ers direct met beveiligingsbedrijven en collega beveiligers voor shifts. Het ondersteunt real-time messaging, groepschats voor teams, en geautomatiseerde shift-gerelateerde berichten.

## Functionaliteit
- **Direct messaging**: 1-op-1 chat met bedrijven en managers
- **Team chats**: Groepsgesprekken voor specifieke shifts of projecten
- **Shift notifications**: Geautomatiseerde berichten voor shift updates
- **File sharing**: Documenten, foto's en instructies delen
- **Quick responses**: Vooraf ingestelde antwoorden voor snelle communicatie
- **Read receipts**: Bevestiging van gelezen berichten

## Key Features
- **Real-time messaging**: Instant delivery en synchronisatie
- **Offline support**: Berichten kunnen offline worden geschreven
- **Message encryption**: End-to-end versleuteling voor privacy
- **Archive functionality**: Oude gesprekken archiveren
- **Search**: Zoeken door berichtgeschiedenis

---

## 🔲 Mobile Versie (375px - 768px)

### Chat Overview - Conversations List
```
┌─────────────────────────────────────┐
│  [←] Berichten          [✏️ Nieuw]  │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 🔍 Zoek gesprekken...       │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ [🏢] SecureEvents B.V.  ● 2m │   │
│  │      "Kun je morgen werken?" │   │
│  │      ─────────────────────── │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ [👤] Guardian Security  15:30│   │
│  │      "Shift bevestigd voor..." │ │
│  │      ─────────────────────── │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ [👥] Team Ajax Arena    Gist.│   │
│  │      📷 Foto gedeeld        │   │
│  │      ─────────────────────── │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ [🏢] NightWatch Sec.    Ma  │   │
│  │      "Training materiaal"   │   │
│  │      ─────────────────────── │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ [📋] System Notificaties    │   │
│  │      "Betaling verwerkt"    │   │
│  │      ─────────────────────── │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ [👥] Weekend Team       Zo  │   │
│  │      "Bedankt team! 💪"     │   │
│  │      ─────────────────────── │   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│ [🏠][💼][💬][📅][👤]             │
│ Dashboard Jobs Chat Planning Profiel│
└─────────────────────────────────────┘
```

### Individual Chat Conversation
```
┌─────────────────────────────────────┐
│  [←] SecureEvents B.V.      [📞][ℹ️] │
│       ● Online                      │
├─────────────────────────────────────┤
│                                     │
│  Vandaag                            │
│                                     │
│        [System] 14:30               │
│    Shift bevestigd: Ajax Arena      │
│    28 Nov, 14:00-22:00             │
│                                     │
│  [Manager] 14:32                    │
│  Hallo Jan! Kun je bevestigen      │
│  dat je de shift instructies       │
│  hebt ontvangen?                   │
│                                     │
│                   [Jij] 14:35       │
│               Ja, alles ontvangen  │
│               ✅ Gelezen            │
│                                     │
│  [Manager] 16:45                    │
│  Perfect! Champions League          │
│  wedstrijd wordt druk. Extra        │
│  briefing morgen 13:30 bij          │
│  hoofdingang. Oké?                 │
│                                     │
│                   [Jij] 16:47       │
│                   Oké, ik ben er!   │
│                   ✅ Gelezen        │
│                                     │
│  [Manager] Nu                       │
│  Kun je morgen werken? Collega      │
│  ziek gemeld voor Schiphol shift.   │
│  06:00-14:00, €17/uur              │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ ✅ Ja, beschikbaar          │   │
│  │ ❌ Nee, niet beschikbaar    │   │
│  │ ⏰ Misschien, laat me kijken │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ Type je bericht...          │   │
│  │                       [📎][📷]│
│  └─────────────────────────────┘   │
│                           [Stuur]  │
│                                     │
├─────────────────────────────────────┤
│ [🏠][💼][💬][📅][👤]             │
│ Dashboard Jobs Chat Planning Profiel│
└─────────────────────────────────────┘
```

### Team Group Chat
```
┌─────────────────────────────────────┐
│  [←] Team Ajax Arena        [👥][ℹ️] │
│       6 leden • 3 online           │
├─────────────────────────────────────┤
│                                     │
│  Gisteren                           │
│                                     │
│  [Tom] 19:45                        │
│  Iedereen goed aangekomen?         │
│  ✅ Gelezen door 5                  │
│                                     │
│  [Jij] 19:46                        │
│  👍 Ben er!                         │
│                                     │
│  [Sarah] 19:47                      │
│  Check! Zie veel supporters         │
│  📷 [Foto van menigte]              │
│                                     │
│  [Ahmed] 19:50                      │
│  Bij ingang B, druk maar goed      │
│  onder controle                    │
│                                     │
│  Vandaag                            │
│                                     │
│  [Manager] 8:30                     │
│  Team, fantastisch werk gisteravond!│
│  Klant super tevreden. Bonus       │
│  komt deze week op jullie rekening │
│  💰                                 │
│                                     │
│                   [Jij] 8:32        │
│               Bedankt! Was top team │
│                                     │
│  [Sarah] 8:33                       │
│  💪 Wanneer de volgende?            │
│                                     │
│  [Tom] 8:35                         │
│  Same team voor volgende CL match? │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ Type je bericht...          │   │
│  │                   [📎][📷][😊]│
│  └─────────────────────────────┘   │
│                           [Stuur]  │
│                                     │
├─────────────────────────────────────┤
│ [🏠][💼][💬][📅][👤]             │
│ Dashboard Jobs Chat Planning Profiel│
└─────────────────────────────────────┘
```

### Quick Response Options
```
┌─────────────────────────────────────┐
│  [←] Snel Antwoorden               │
├─────────────────────────────────────┤
│                                     │
│  📝 Beschikbaarheid                 │
│  ┌─────────────────────────────┐   │
│  │ ✅ Ja, ik ben beschikbaar    │   │
│  │ ❌ Nee, niet beschikbaar     │   │
│  │ ⏰ Laat me even kijken       │   │
│  │ 📅 Welke datum precies?      │   │
│  │ ⏱️ Hoe laat begint het?      │   │
│  └─────────────────────────────┘   │
│                                     │
│  🎯 Shift Status                    │
│  ┌─────────────────────────────┐   │
│  │ 🚗 Onderweg naar locatie     │   │
│  │ 📍 Aangekomen op locatie     │   │
│  │ ✅ Check-in voltooid         │   │
│  │ 🏁 Shift afgerond            │   │
│  │ ❓ Vraag over instructies    │   │
│  └─────────────────────────────┘   │
│                                     │
│  💬 Algemeen                        │
│  ┌─────────────────────────────┐   │
│  │ 👍 Begrepen                  │   │
│  │ 👌 Akkoord                   │   │
│  │ 🙏 Bedankt                   │   │
│  │ ❓ Kan je dat herhalen?      │   │
│  │ 📞 Kunnen we even bellen?    │   │
│  └─────────────────────────────┘   │
│                                     │
│  🆘 Noodgevallen                    │
│  ┌─────────────────────────────┐   │
│  │ 🚨 Noodgeval - hulp nodig    │   │
│  │ 🏥 Medische hulp nodig       │   │
│  │ 👮 Politie gewaarschuwd      │   │
│  │ 🔥 Brandweer gebeld          │   │
│  └─────────────────────────────┘   │
│                                     │
│  [+ Aangepaste antwoorden toevoegen] │
│                                     │
├─────────────────────────────────────┤
│ [🏠][💼][💬][📅][👤]             │
│ Dashboard Jobs Chat Planning Profiel│
└─────────────────────────────────────┘
```

---

## 🖥️ Desktop Versie (1024px+)

### Desktop Chat Interface
```
┌───────────────────────────────────────────────────────────────────────────────┐
│  [←] Chat Dashboard                                          [Settings] [Help] │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│ ┌─────────────────────────┐ ┌───────────────────────────────────────────────┐ │
│ │     💬 GESPREKKEN       │ │              SecureEvents B.V.                │ │
│ │                         │ │              ● Online - Laatst: 2 min         │ │
│ ├─────────────────────────┤ ├───────────────────────────────────────────────┤ │
│ │ 🔍 Zoeken...            │ │                                               │ │
│ ├─────────────────────────┤ │ [System] 14:30                                │ │
│ │                         │ │ Shift bevestigd: Ajax Arena 28 Nov 14:00-22:00│ │
│ │ ● SecureEvents B.V.  2m │ │                                               │ │
│ │   "Kun je morgen..."     │ │ [Manager] 14:32                               │ │
│ │ ─────────────────────── │ │ Hallo Jan! Kun je bevestigen dat je de       │ │
│ │                         │ │ shift instructies hebt ontvangen?            │ │
│ │ ● Guardian Security  15m│ │                                               │ │
│ │   "Shift bevestigd..."  │ │                                    [Jij] 14:35│ │
│ │ ─────────────────────── │ │                         Ja, alles ontvangen  │ │
│ │                         │ │                         ✅ Gelezen           │ │
│ │ ● Team Ajax Arena   2h  │ │                                               │ │
│ │   📷 "Foto gedeeld"     │ │ [Manager] 16:45                               │ │
│ │ ─────────────────────── │ │ Perfect! Champions League wedstrijd wordt    │ │
│ │                         │ │ druk. Extra briefing morgen 13:30 bij        │ │
│ │ ● NightWatch Sec.   1d  │ │ hoofdingang. Oké?                            │ │
│ │   "Training materiaal"  │ │                                               │ │
│ │ ─────────────────────── │ │                                    [Jij] 16:47│ │
│ │                         │ │                              Oké, ik ben er! │ │
│ │ ● System             1d  │ │                              ✅ Gelezen       │ │
│ │   "Betaling verwerkt"   │ │                                               │ │
│ │ ─────────────────────── │ │ [Manager] Nu • Online                         │ │
│ │                         │ │ Kun je morgen werken? Collega ziek gemeld     │ │
│ │ ● Weekend Team       3d │ │ voor Schiphol shift. 06:00-14:00, €17/uur    │ │
│ │   "Bedankt team! 💪"   │ │                                               │ │
│ │                         │ │ ┌─── Snelle Antwoorden ───┐                   │ │
│ │ [+ Nieuw gesprek]       │ │ │ ✅ Ja, beschikbaar       │                   │ │
│ │ [📁 Gearchiveerd]       │ │ │ ❌ Nee, niet beschik.   │                   │ │
│ │                         │ │ │ ⏰ Laat me even kijken   │                   │ │
│ └─────────────────────────┘ │ └──────────────────────────┘                   │ │
│                             │                                               │ │
│                             │ ┌─────────────────────────────────────────────┐ │
│                             │ │ Type je bericht...                          │ │
│                             │ │                          [📎][📷][😊][🎯]  │ │
│                             │ └─────────────────────────────────────────────┘ │
│                             │                                      [Stuur]  │ │
│                             └───────────────────────────────────────────────┘ │
│                                                                               │
├───────────────────────────────────────────────────────────────────────────────┤
│ [🏠 Dashboard] [💼 Jobs] [💬 Chat] [📅 Planning] [👤 Profiel]              │
└───────────────────────────────────────────────────────────────────────────────┘
```

### Desktop Team Chat View
```
┌───────────────────────────────────────────────────────────────────────────────┐
│  [←] Chat Dashboard                                          [Settings] [Help] │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│ ┌─────────────────────────┐ ┌───────────────────────────────────────────────┐ │
│ │     💬 GESPREKKEN       │ │            👥 Team Ajax Arena                 │ │
│ │                         │ │            6 leden • 3 online                │ │
│ ├─────────────────────────┤ ├───────────────────────────────────────────────┤ │
│ │ 🔍 Zoeken...            │ │                                               │ │
│ ├─────────────────────────┤ │ Gisteren                                      │ │
│ │                         │ │                                               │ │
│ │ ● SecureEvents B.V.  2m │ │ [Tom] 19:45                                   │ │
│ │   "Kun je morgen..."     │ │ Iedereen goed aangekomen?                    │ │
│ │ ─────────────────────── │ │ ✅ Gelezen door 5                             │ │
│ │                         │ │                                               │ │
│ │ ● Guardian Security  15m│ │                                    [Jij] 19:46│ │
│ │   "Shift bevestigd..."  │ │                                     👍 Ben er!│ │
│ │ ─────────────────────── │ │                                               │ │
│ │                         │ │ [Sarah] 19:47                                 │ │
│ │ ● Team Ajax Arena   2h  │ │ Check! Zie veel supporters                    │ │
│ │   📷 "Foto gedeeld"     │ │ 📷 [Crowd photo thumbnail 200x150]            │ │
│ │ ─────────────────────── │ │                                               │ │
│ │                         │ │ [Ahmed] 19:50                                 │ │
│ │ ● NightWatch Sec.   1d  │ │ Bij ingang B, druk maar goed onder controle  │ │
│ │   "Training materiaal"  │ │                                               │ │
│ │ ─────────────────────── │ │ Vandaag                                       │ │
│ │                         │ │                                               │ │
│ │ ● System             1d  │ │ [Manager] 8:30                                │ │
│ │   "Betaling verwerkt"   │ │ Team, fantastisch werk gisteravond! Klant    │ │
│ │ ─────────────────────── │ │ super tevreden. Bonus komt deze week 💰      │ │
│ │                         │ │                                               │ │
│ │ ● Weekend Team       3d │ │                                    [Jij] 8:32 │ │
│ │   "Bedankt team! 💪"   │ │                         Bedankt! Was top team │ │
│ │                         │ │                                               │ │
│ │ ┌─── Team Info ────────┐│ │ [Sarah] 8:33                                  │ │
│ │ │ 👤 Jij (Online)       ││ │ 💪 Wanneer de volgende?                      │ │
│ │ │ 👤 Tom (Online)       ││ │                                               │ │
│ │ │ 👤 Sarah (Online)     ││ │ [Tom] 8:35                                    │ │
│ │ │ 👤 Ahmed (30m geleden)││ │ Same team voor volgende CL match?            │ │
│ │ │ 👤 Mike (Offline)     ││ │                                               │ │
│ │ │ 👤 Lisa (Offline)     ││ │ ┌─────────────────────────────────────────┐   │ │
│ │ └───────────────────────┘│ │ │ Type je bericht...                      │   │ │
│ │                         │ │ │                      [📎][📷][😊][🎯]  │   │ │
│ └─────────────────────────┘ │ └─────────────────────────────────────────┘   │ │
│                             │                                      [Stuur] │ │
│                             └───────────────────────────────────────────────┘ │
│                                                                               │
├───────────────────────────────────────────────────────────────────────────────┤
│ [🏠 Dashboard] [💼 Jobs] [💬 Chat] [📅 Planning] [👤 Profiel]              │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 🔄 Real-time Features

### WebSocket Integration
```typescript
interface ChatMessage {
  id: string;
  conversationId: string;
  senderId: string;
  senderType: 'zzp' | 'company' | 'system';
  content: string;
  messageType: 'text' | 'file' | 'image' | 'system';
  timestamp: Date;
  readBy: string[];
  reactions?: MessageReaction[];
}

interface MessageReaction {
  userId: string;
  emoji: string;
  timestamp: Date;
}
```

### Live Features
- **Typing indicators**: Toon wanneer iemand aan het typen is
- **Online status**: Real-time online/offline status
- **Read receipts**: Bevestiging dat berichten gelezen zijn
- **Message delivery**: Status van bericht delivery
- **Push notifications**: Instant alerts voor nieuwe berichten

---

## 📁 File Sharing & Media

### Supported File Types
- **Images**: JPG, PNG, GIF, WebP (automatische compressie)
- **Documents**: PDF, DOC, XLS, TXT
- **Video**: MP4, MOV (voor incident rapportage)
- **Audio**: Voice messages (voor snelle communicatie)

### File Upload Flow
```typescript
interface FileUpload {
  file: File;
  conversationId: string;
  uploadProgress: number;
  thumbnailUrl?: string;
  compressedSize?: number;
}

// Auto-compression voor afbeeldingen
const compressImage = (file: File): Promise<Blob> => {
  // Comprimeer naar max 1920x1080, 80% kwaliteit
  // Voor chat: max 800x600, 70% kwaliteit
};
```

---

## 🤖 Automated Messages

### System Generated Messages
```typescript
interface SystemMessage {
  type: 'shift_assigned' | 'shift_reminder' | 'payment_processed' | 'document_expiry';
  recipientId: string;
  data: any;
  template: string;
  scheduledAt?: Date;
}

// Voorbeelden:
const systemMessages = {
  shift_assigned: "Shift toegewezen: {shiftTitle} op {date} van {startTime} tot {endTime}",
  shift_reminder: "Herinnering: Je shift bij {location} begint over 2 uur",
  payment_processed: "Betaling ontvangen: €{amount} voor shift {shiftTitle}",
  document_expiry: "Document '{documentName}' verloopt over {days} dagen"
};
```

### Auto-responses
- **Out of office**: Automatische reacties bij unavailability
- **Shift confirmations**: Auto-bevestiging van shift toewijzingen
- **Emergency contacts**: Automatische doorverwijzing bij noodgevallen

---

## 💾 Data Requirements

### Chat API Endpoints
```typescript
// Get conversations
GET /api/zzp/conversations
{
  conversations: Conversation[],
  unreadCount: number,
  lastSeen: Date
}

// Get messages
GET /api/zzp/conversations/{id}/messages?before={timestamp}&limit=50
{
  messages: ChatMessage[],
  hasMore: boolean,
  participants: Participant[]
}

// Send message
POST /api/zzp/conversations/{id}/messages
{
  content: string,
  type: 'text' | 'file' | 'image',
  fileId?: string
}

// Mark as read
PUT /api/zzp/conversations/{id}/read
{
  lastReadAt: Date
}
```

### Real-time WebSocket
```typescript
WebSocket: /realtime/chat/{userId}
- message_new: ChatMessage
- message_read: ReadReceipt
- typing_start: TypingIndicator
- typing_stop: TypingIndicator
- user_online: UserStatus
- user_offline: UserStatus
```

### Database Schema Used
- **conversations** (participants, type, lastMessage, createdAt)
- **messages** (conversationId, senderId, content, messageType)
- **messageReads** (messageId, userId, readAt)
- **fileUploads** (for shared files)

---

## 🔒 Privacy & Security

### Message Encryption
- **End-to-end encryption**: Berichten encrypted tussen gebruikers
- **Server-side encryption**: Database level encryption voor opgeslagen berichten
- **File encryption**: Geüploade bestanden encrypted in Supabase Storage
- **Key rotation**: Automatische rotatie van encryption keys

### Privacy Controls
```typescript
interface PrivacySettings {
  allowMessagesFromUnknown: boolean;
  readReceiptsEnabled: boolean;
  onlineStatusVisible: boolean;
  messagePreviewInNotifications: boolean;
  autoDeleteMessages: number; // dagen, 0 = nooit
}
```

### GDPR Compliance
- **Data retention**: Berichten automatisch verwijderd na ingestelde periode
- **Right to deletion**: Gebruikers kunnen gesprekken verwijderen
- **Data export**: Volledige chat geschiedenis exporteren
- **Consent management**: Expliciete toestemming voor berichtopslag

---

## 📱 Offline Support

### Offline Capabilities
- **Draft messages**: Berichten kunnen offline geschreven worden
- **Message queue**: Automatische verzending zodra online
- **Cached conversations**: Recente gesprekken offline beschikbaar
- **Read sync**: Synchronisatie van gelezen berichten

### Data Synchronization
```typescript
interface OfflineMessage {
  tempId: string;
  conversationId: string;
  content: string;
  timestamp: Date;
  synced: boolean;
  retryCount: number;
}

// Background sync wanneer online
const syncOfflineMessages = async () => {
  const unsynced = await getUnsyncedMessages();
  for (const message of unsynced) {
    try {
      await sendMessage(message);
      await markAsSynced(message.tempId);
    } catch (error) {
      await incrementRetryCount(message.tempId);
    }
  }
};
```

---

## 📊 Success Metrics

### Communication KPIs
- **Response time**: Gemiddelde tijd tussen ontvangen en beantwoorden
- **Message read rate**: % berichten dat gelezen wordt
- **File sharing usage**: Aantal gedeelde bestanden per conversatie
- **Quick response usage**: % gebruik van vooraf ingestelde antwoorden

### User Engagement
- **Daily active chats**: Aantal gesprekken per dag
- **Message volume**: Aantal berichten verzonden per gebruiker
- **Conversation duration**: Gemiddelde lengte van gesprekken
- **Satisfaction rating**: Rating van communicatie ervaring

### Performance Targets
- **Message delivery**: < 100ms voor tekst berichten
- **File upload**: < 5 seconden voor afbeeldingen
- **Offline sync**: < 2 seconden voor message queue sync
- **Search performance**: < 500ms voor chat geschiedenis zoeken

---

## 🎯 Advanced Features

### AI-Powered Suggestions
```typescript
interface MessageSuggestion {
  type: 'quick_reply' | 'translation' | 'grammar_check' | 'context_aware';
  suggestion: string;
  confidence: number; // 0-1
  context: string;
}

// Context-aware suggestions
const generateSuggestions = (conversation: Conversation): MessageSuggestion[] => {
  // AI analyseert conversatie context en genereert relevante antwoorden
  // Bijv. "Ja, ik kan die shift doen" bij shift aanbiedingen
};
```

### Smart Notifications
- **Priority scoring**: Urgente berichten krijgen hogere prioriteit
- **Context awareness**: Notificaties aangepast aan huidige activiteit
- **Quiet hours**: Automatisch notifications dempen tijdens slaapuren
- **Grouping**: Gerelateerde berichten gegroepeerd in één notificatie

### Integration Features
- **Calendar sync**: Automatisch shift details naar agenda
- **Contact sync**: Bedrijfscontacten synchroniseren met telefoon
- **Translation**: Real-time vertaling voor internationale teams
- **Voice-to-text**: Spraakberichten automatisch transcriberen